---
// src/components/ui/ThemeToggle.astro
---

<button 
  id="theme-toggle-btn"
  style="
    position: fixed;
    bottom: 6rem;
    right: 1rem;
    z-index: 50;
    width: 2rem;
    height: 2rem;
    border-radius: 50%;
    border: none;
    background: rgba(59, 130, 246, 0.1);
    cursor: pointer;
    font-size: 1.2rem;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
  "
  aria-label="åˆ‡æ¢ä¸»é¢˜"
  title="åˆ‡æ¢äº®è‰²/æš—è‰²ä¸»é¢˜"
>
  ğŸŒ™
</button>

<script>
  (function() {
    const themeBtn = document.getElementById('theme-toggle-btn');
    
    // è·å–å½“å‰ä¸»é¢˜
    function getCurrentTheme() {
      const saved = localStorage.getItem('theme');
      const systemDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      return saved || (systemDark ? 'dark' : 'light');
    }
    
    // è®¾ç½®ä¸»é¢˜
    function setTheme(theme) {
      document.documentElement.setAttribute('data-theme', theme);
      localStorage.setItem('theme', theme);
      updateButton(theme);
    }
    
    // æ›´æ–°æŒ‰é’®å›¾æ ‡å’Œæç¤º
    function updateButton(theme) {
      if (!themeBtn) return;
      
      if (theme === 'dark') {
        themeBtn.textContent = 'â˜€ï¸';
        themeBtn.setAttribute('aria-label', 'åˆ‡æ¢åˆ°äº®è‰²ä¸»é¢˜');
        themeBtn.setAttribute('title', 'åˆ‡æ¢åˆ°äº®è‰²ä¸»é¢˜');
        themeBtn.style.background = 'rgba(251, 191, 36, 0.15)'; // æ©™è‰²èƒŒæ™¯
      } else {
        themeBtn.textContent = 'ğŸŒ™';
        themeBtn.setAttribute('aria-label', 'åˆ‡æ¢åˆ°æš—è‰²ä¸»é¢˜');
        themeBtn.setAttribute('title', 'åˆ‡æ¢åˆ°æš—è‰²ä¸»é¢˜');
        themeBtn.style.background = 'rgba(59, 130, 246, 0.15)'; // è“è‰²èƒŒæ™¯
      }
    }
    
    // åˆ‡æ¢ä¸»é¢˜
    function toggleTheme() {
      const currentTheme = getCurrentTheme();
      const newTheme = currentTheme === 'light' ? 'dark' : 'light';
      setTheme(newTheme);
    }
    
    // åˆå§‹åŒ–
    function initTheme() {
      const theme = getCurrentTheme();
      setTheme(theme);
      
      // ç›‘å¬ç³»ç»Ÿä¸»é¢˜å˜åŒ–
      window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
        if (!localStorage.getItem('theme')) {
          setTheme(e.matches ? 'dark' : 'light');
        }
      });
    }
    
    // äº‹ä»¶ç›‘å¬
    themeBtn.addEventListener('click', toggleTheme);
    
    // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', initTheme);
    
    // é”®ç›˜å¿«æ·é”®ï¼šAlt+T åˆ‡æ¢ä¸»é¢˜
    document.addEventListener('keydown', function(event) {
      if (event.altKey && event.key === 't') {
        event.preventDefault();
        toggleTheme();
      }
    });
  })();
</script>

<style>
  /* æŒ‰é’®æ‚¬åœæ•ˆæœ */
  #theme-toggle-btn:hover {
    transform: scale(1.1);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
  }
  
  #theme-toggle-btn:active {
    transform: scale(0.95);
  }
</style>