---
// src/pages/oldblogpages.astro
import BaseLayout from '../layouts/BaseLayout.astro';
import 'src/styles/oldblogpages.css';
---

<BaseLayout title="博客" description="查看博客">

  <main>
    <article>
      <div class="prose">
        <!-- 每日语录部分 -->
        <div class="quote-container">
          <!-- 只保留容器，内容由JS填充 -->
          <div class="quote-text" id="daily-quote"></div>
          <hr />
        </div>

        <!-- 每日轮换图片轮播 -->
        <div class="daily-rotating-image">
          <div class="image-container" id="image-container">
            <img id="daily-img" alt="每日图片" loading="lazy" class="daily-image">
            <!-- 导航按钮 -->
            <button class="nav-btn prev-btn" id="prev-btn" aria-label="上一张">‹</button>
            <button class="nav-btn next-btn" id="next-btn" aria-label="下一张">›</button>
          </div>
        </div>
        
        <br>
        
        <!-- 文章列表 -->
        <div class="article-list">
          <!-- 文章1 -->
          <a href="/blog/学习" class="article-item">
            <div class="article-image">
              <img src="/images/xiaohei.jpg" alt="学习" />
              <div class="article-title">学习</div>
            </div>
          </a>
          
          <!-- 文章2 -->
          <a href="/blog/社交" class="article-item">
            <div class="article-image">
              <img src="/images/fulilian.jpg" alt="社交" />
              <div class="article-title">社交</div>
            </div>
          </a>
          
          <!-- 文章3 -->
          <a href="/blog/个体" class="article-item">
            <div class="article-image">
              <img src="/images/aniya.jpg" alt="个体" />
              <div class="article-title">个体</div>
            </div>
          </a>
        </div>
      </div>
    </article>
  </main>
</BaseLayout>



<script>
  // 使用立即执行函数避免全局变量污染
  (function() {
    'use strict';
    
    // 每日语录列表
    const quotes = [
      "他们是名人，我们是人名，不一样的。",
      "梦想不会逃跑，逃跑的只有自己。",
      "It's not a silver bullet.",
      "Just a little more",
      //"葡萄成熟时，羊群回家。",
      "一念四海平，一念百花开。"
    ];
    
    const imageList = [
      '/images/girl.jpg',
      '/images/witch.png',
      '/images/welcome.jpg',
      '/images/butterflies.jpg',
      '/images/ganlusimili.jpg',
      '/images/xiamu.jpg',
      '/images/haizeiwang.jpg',
      '/images/jiatenghui.jpg',
      '/images/kelasong.jpg',
      '/images/youyouzi.jpg',
      '/images/haizeiwang2.jpg',
      '/images/xinmeier.jpg',
      '/images/xisiteliya.jpg',
      '/images/zou.jpg'
    ];
    
    // 轮播状态变量
    let currentImageIndex = 0;
    let touchStartX = 0;
    
    // 获取DOM元素
    const dailyImg = document.getElementById('daily-img');
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    const imageContainer = document.getElementById('image-container');
    const quoteElement = document.getElementById('daily-quote');
    
    // 安全地显示图片
    function showImage(index) {
      // 确保索引在有效范围内
      if (index < 0) {
        index = imageList.length - 1;
      } else if (index >= imageList.length) {
        index = 0;
      }
      
      currentImageIndex = index;
      
      // 更新图片
      if (dailyImg) {
        const imageUrl = imageList[currentImageIndex];
        const imageAlt = `每日图片 ${currentImageIndex + 1}/${imageList.length}`;
        
        // 使用setAttribute避免类型错误
        dailyImg.setAttribute('src', imageUrl);
        dailyImg.setAttribute('alt', imageAlt);
        
        // 淡入效果
        dailyImg.style.opacity = '0';
        setTimeout(function() {
          dailyImg.style.opacity = '1';
        }, 50);
      }
    }
    
    // 加载每日图片
    function loadDailyImage() {
      const today = new Date();
      const dayOfWeek = today.getDay();
      currentImageIndex = dayOfWeek % imageList.length;
      showImage(currentImageIndex);
    }
    
    // 显示上一张图片
    function showPrevImage() {
      showImage(currentImageIndex - 1);
    }
    
    // 显示下一张图片
    function showNextImage() {
      showImage(currentImageIndex + 1);
    }
    
    // 触摸事件处理
    function handleTouchStart(event) {
      if (event.touches && event.touches.length > 0) {
        touchStartX = event.touches[0].clientX;
      }
    }
    
    function handleTouchEnd(event) {
      if (!touchStartX) return;
      
      const touchEndX = event.changedTouches[0].clientX;
      const diff = touchStartX - touchEndX;
      
      // 滑动阈值
      if (Math.abs(diff) > 50) {
        if (diff > 0) {
          // 向左滑动，显示下一张
          showNextImage();
        } else {
          // 向右滑动，显示上一张
          showPrevImage();
        }
      }
      
      touchStartX = 0;
    }
    
    // 每日语录功能
    function setupDailyQuote() {
      if (!quoteElement) return;
      
      const today = new Date();
      const dateString = today.getFullYear().toString() + today.getMonth().toString() + today.getDate().toString();
      const quoteIndex = parseInt(dateString) % quotes.length;
      
      quoteElement.textContent = quotes[quoteIndex];
    }
    
    // 绑定事件
    function bindEvents() {
      // 按钮事件
      if (prevBtn) {
        prevBtn.addEventListener('click', showPrevImage);
      }
      
      if (nextBtn) {
        nextBtn.addEventListener('click', showNextImage);
      }
      
      // 键盘事件
      document.addEventListener('keydown', function(event) {
        if (event.key === 'ArrowLeft') {
          showPrevImage();
        } else if (event.key === 'ArrowRight') {
          showNextImage();
        }
      });
      
      // 触摸事件
      if (imageContainer) {
        imageContainer.addEventListener('touchstart', handleTouchStart);
        imageContainer.addEventListener('touchend', handleTouchEnd);
      }
    }
    
    // 初始化页面
    function initPage() {
      // 设置每日语录
      setupDailyQuote();
      
      // 加载每日图片
      loadDailyImage();
      
      // 绑定事件
      bindEvents();
    }
    
    // 页面加载完成后初始化
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initPage);
    } else {
      // DOM已经加载完成
      initPage();
    }
  })();
</script>